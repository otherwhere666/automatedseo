---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogArticleCard from '../../components/BlogArticleCard.astro';
import CategoryPill from '../../components/CategoryPill.astro';
import { getAllPillars, getPillarById, getPostsByPillar, getAllDestinations, getAllCaseStudies } from '../../utils/content';

export async function getStaticPaths() {
  const pillars = getAllPillars();
  return pillars.map(pillar => ({ params: { pillar: pillar.id } }));
}

const { pillar: pillarId } = Astro.params;
const pillar = getPillarById(pillarId);

if (!pillar) {
  return Astro.redirect('/topics', 301);
}

const posts = getPostsByPillar(pillarId);

// Get related destinations and case studies
const featuredDestinations = getAllDestinations().slice(0, 3);
const featuredCaseStudies = getAllCaseStudies().slice(0, 4);

const schemas = [
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": `${pillar.name} | Otherwhere Blog`,
    "description": pillar.angle
  }
];
---

<BaseLayout
  title={`${pillar.name} | Travel Articles | Otherwhere`}
  description={pillar.angle}
  schema={schemas}
>
  <!-- Hero Section (Cream) -->
  <section class="bg-paper py-12 md:py-16">
    <div class="max-w-wide mx-auto px-6">
      <a href="/topics" class="text-xs uppercase tracking-widest text-ink-tertiary hover:text-ink transition-colors mb-6 inline-block">
        ← ALL TOPICS
      </a>
      <header class="mb-10">
        <CategoryPill category={pillar.priority === 'high' ? 'Featured Topic' : 'Topic'} variant="dark" class="mb-4" />
        <h1 class="font-display text-4xl md:text-5xl lg:text-6xl tracking-wide">{pillar.name.toUpperCase()}</h1>
        <p class="text-ink-secondary mt-4 text-lg max-w-2xl">
          {pillar.angle}
        </p>
      </header>

      <!-- Stats -->
      <div class="flex gap-12">
        <div>
          <p class="font-display text-4xl">{posts.length}</p>
          <p class="text-sm text-ink-tertiary mt-1">Articles</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Articles Grid (Dark) -->
  <section class="section-dark py-16 md:py-20">
    <div class="max-w-wide mx-auto px-6">
      <header class="mb-12">
        <h2 class="font-display text-3xl md:text-4xl text-paper">ARTICLES</h2>
      </header>

      {posts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
          {posts.map((post, index) => (
            <BlogArticleCard post={post} variant="dark" index={index} />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-paper/70 text-lg mb-4">No articles in this topic yet.</p>
          <p class="text-paper/50 text-sm">Check back soon — new content is published regularly.</p>
        </div>
      )}
    </div>
  </section>

  <!-- Related Destinations (Cream) -->
  <section class="bg-paper py-16 md:py-20">
    <div class="max-w-wide mx-auto px-6">
      <header class="mb-10 flex items-end justify-between">
        <div>
          <p class="text-xs uppercase tracking-widest text-ink-tertiary mb-2" style="letter-spacing: 0.15em;">
            EXPLORE
          </p>
          <h2 class="font-display text-3xl md:text-4xl">DESTINATIONS</h2>
        </div>
        <a href="/destinations" class="text-ink-tertiary hover:text-ink text-sm uppercase tracking-wider transition-colors">
          View all →
        </a>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuredDestinations.map((dest) => (
          <a href={`/destinations/${dest.slug}`} class="magazine-card group">
            <div class="relative mb-4">
              <img
                src={dest.image}
                alt={dest.city}
                class="magazine-card-image"
                loading="lazy"
              />
            </div>
            <div class="space-y-2">
              <CategoryPill category={dest.country} variant="dark" />
              <h3 class="font-display text-xl md:text-2xl leading-tight text-ink">
                {dest.city}
              </h3>
              <p class="text-sm text-ink-secondary">{dest.tagline}</p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Related Case Studies (Dark) -->
  <section class="section-dark py-16 md:py-20">
    <div class="max-w-wide mx-auto px-6">
      <header class="mb-10 flex items-end justify-between">
        <div>
          <p class="text-xs uppercase tracking-widest text-paper/50 mb-2" style="letter-spacing: 0.15em;">
            SEE HOW IT WORKS
          </p>
          <h2 class="font-display text-3xl md:text-4xl text-paper">TRIPS WE PLANNED</h2>
        </div>
        <a href="/case-studies" class="text-paper/70 hover:text-paper text-sm uppercase tracking-wider transition-colors">
          View all →
        </a>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        {featuredCaseStudies.map((cs) => (
          <a href={`/case-studies/${cs.slug}`} class="magazine-card group">
            <div class="relative mb-4">
              <img
                src={cs.image}
                alt={cs.title}
                class="magazine-card-image"
                loading="lazy"
              />
            </div>
            <div class="space-y-2">
              <CategoryPill category={cs.type} variant="light" />
              <h3 class="font-display text-lg md:text-xl leading-tight text-paper">
                {cs.title}
              </h3>
              <p class="text-paper/70 text-sm italic line-clamp-2">"{cs.quote}"</p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA (Cream) -->
  <section class="bg-paper py-20 md:py-24">
    <div class="max-w-wide mx-auto px-6 text-center">
      <p class="text-xs uppercase tracking-widest text-ink-tertiary mb-4" style="letter-spacing: 0.15em;">
        READY?
      </p>
      <h2 class="font-display text-3xl md:text-4xl lg:text-5xl mb-6">
        EXPERIENCE THIS YOURSELF
      </h2>
      <p class="text-ink-secondary text-lg mb-10 max-w-md mx-auto">
        Text us where you want to go. We'll show you how personal travel booking works.
      </p>
      <a href="sms:+13239224067" class="btn-pill btn-pill-primary inline-block">
        TEXT US TO START
      </a>
    </div>
  </section>
</BaseLayout>
