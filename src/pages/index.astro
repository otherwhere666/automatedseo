---
import BaseLayout from '../layouts/BaseLayout.astro';
import fs from 'node:fs';
import path from 'node:path';

// Read blog posts from content/posts
const postsDir = path.join(process.cwd(), 'content', 'posts');
let blogPosts: any[] = [];

try {
  const files = fs.readdirSync(postsDir).filter(f => f.endsWith('.mdx'));
  for (const file of files) {
    const content = fs.readFileSync(path.join(postsDir, file), 'utf-8');
    const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
    if (frontmatterMatch) {
      const frontmatter = frontmatterMatch[1];
      const title = frontmatter.match(/title:\s*"([^"]+)"/)?.[1] || 'Untitled';
      const description = frontmatter.match(/description:\s*"([^"]+)"/)?.[1] || '';
      const publishDate = frontmatter.match(/publishDate:\s*"([^"]+)"/)?.[1] || '';
      const image = frontmatter.match(/image:\s*"([^"]+)"/)?.[1] || '';
      const slug = file.replace('.mdx', '');
      blogPosts.push({ title, description, publishDate, image, slug });
    }
  }
  blogPosts.sort((a, b) => new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime());
  blogPosts = blogPosts.slice(0, 4); // Show max 4 on homepage
} catch (e) {
  // No posts yet
}

// Featured articles with Unsplash images
const heroArticle = {
  title: "What is Otherwhere?",
  dek: "AI travel concierge: text or call to get curated trip options and booking help",
  slug: "/what-is-otherwhere",
  image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1600&h=900&fit=crop",
  author: "Otherwhere"
};

const featuredArticles = [
  {
    title: "Otherwhere vs ChatGPT for travel",
    dek: "ChatGPT is great for brainstorming, but it can't book. Here's what actually works.",
    slug: "/otherwhere-vs-chatgpt",
    image: "https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&h=600&fit=crop",
    author: "Otherwhere"
  },
  {
    title: "What is an AI travel concierge?",
    dek: "The category explained: what it is, how it works, and who it's for.",
    slug: "/what-is-ai-travel-concierge",
    image: "https://images.unsplash.com/photo-1582719508461-905c673771fd?w=800&h=600&fit=crop",
    author: "Otherwhere"
  }
];

const caseStudies = [
  {
    title: "The honeymoon couple: Puglia, Italy",
    dek: "How we found the perfect romantic escape for foodies who wanted somewhere not basic.",
    slug: "/case-studies/honeymoon-puglia",
    image: "https://images.unsplash.com/photo-1534008897995-27a23e859048?w=800&h=600&fit=crop",
    author: "Otherwhere"
  },
  {
    title: "The burned-out founder: Iceland",
    dek: "A remote luxury lodge for someone who needed to disappear.",
    slug: "/case-studies/burnout-escape-iceland",
    image: "https://images.unsplash.com/photo-1520769945061-0a448c463865?w=800&h=600&fit=crop",
    author: "Otherwhere"
  },
  {
    title: "The surprise anniversary: Burgundy",
    dek: "Planning a 20th anniversary trip without her knowing.",
    slug: "/case-studies/surprise-anniversary-burgundy",
    image: "https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=800&h=600&fit=crop",
    author: "Otherwhere"
  },
  {
    title: "The returning customer: Lisbon",
    dek: "When we already know what you like.",
    slug: "/case-studies/returning-customer-lisbon",
    image: "https://images.unsplash.com/photo-1555881400-74d7acaacd8b?w=800&h=600&fit=crop",
    author: "Otherwhere"
  }
];

const destinations = [
  {
    title: "Where to stay in Lisbon",
    dek: "A curated guide for different types of travelers",
    slug: "/destinations/lisbon",
    image: "https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=800&h=600&fit=crop",
    author: "Otherwhere"
  }
];
---

<BaseLayout
  title="Otherwhere | AI Travel Concierge Insights"
  description="Travel planning insights from Otherwhere, the AI travel concierge. Curated guides, destination tips, and why the future of booking is curation, not search."
>
  <div class="max-w-wide mx-auto px-6 py-12">

    <!-- Section: Inspiration -->
    <section class="mb-20">
      <h1 class="section-label text-center">Inspiration</h1>

      <!-- Hero Article -->
      <a href={heroArticle.slug} class="article-hero block mb-16">
        <img
          src={heroArticle.image}
          alt={heroArticle.title}
          class="article-hero-image"
          loading="eager"
        />
        <div class="max-w-article mx-auto text-center">
          <h2 class="article-hero-title">{heroArticle.title}</h2>
          <p class="article-hero-dek">{heroArticle.dek}</p>
          <span class="article-hero-byline">By {heroArticle.author}</span>
        </div>
      </a>

      <!-- Two-column featured -->
      <div class="grid md:grid-cols-2 gap-8 max-w-wide mx-auto">
        {featuredArticles.map((article) => (
          <a href={article.slug} class="article-card">
            <img
              src={article.image}
              alt={article.title}
              class="article-card-image"
              loading="lazy"
            />
            <h3 class="article-card-title">{article.title}</h3>
            <p class="article-card-dek">{article.dek}</p>
            <span class="article-card-byline">By {article.author}</span>
          </a>
        ))}
      </div>
    </section>

    <div class="divider max-w-article mx-auto"></div>

    <!-- Section: Trips We Planned -->
    <section class="mb-20">
      <h2 class="section-label text-center">Trips We Planned</h2>

      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {caseStudies.map((article) => (
          <a href={article.slug} class="article-card">
            <img
              src={article.image}
              alt={article.title}
              class="article-card-image"
              loading="lazy"
            />
            <h3 class="article-card-title text-headline-sm">{article.title}</h3>
            <p class="article-card-dek">{article.dek}</p>
          </a>
        ))}
      </div>

      <div class="text-center mt-10">
        <a href="/case-studies" class="cta-subtle">View all case studies</a>
      </div>
    </section>

    <div class="divider max-w-article mx-auto"></div>

    <!-- Section: Blog -->
    {blogPosts.length > 0 && (
      <section class="mb-20">
        <h2 class="section-label text-center">From the Blog</h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
          {blogPosts.map((post) => (
            <a href={`/blog/${post.slug}`} class="article-card">
              {post.image && (
                <img
                  src={post.image}
                  alt={post.title}
                  class="article-card-image"
                  loading="lazy"
                />
              )}
              <h3 class="article-card-title text-headline-sm">{post.title}</h3>
              <p class="article-card-dek">{post.description}</p>
            </a>
          ))}
        </div>

        <div class="text-center mt-10">
          <a href="/blog" class="cta-subtle">View all blog posts</a>
        </div>
      </section>
    )}

    {blogPosts.length > 0 && <div class="divider max-w-article mx-auto"></div>}

    <!-- Section: Destinations -->
    <section class="mb-20">
      <h2 class="section-label text-center">Destinations</h2>

      <div class="max-w-2xl mx-auto">
        {destinations.map((article) => (
          <a href={article.slug} class="article-card block">
            <img
              src={article.image}
              alt={article.title}
              class="article-hero-image"
              loading="lazy"
            />
            <div class="text-center">
              <h3 class="article-hero-title text-headline">{article.title}</h3>
              <p class="article-hero-dek">{article.dek}</p>
            </div>
          </a>
        ))}
      </div>

      <div class="text-center mt-10">
        <a href="/destinations" class="cta-subtle">View all destinations</a>
      </div>
    </section>

    <div class="divider max-w-article mx-auto"></div>

    <!-- Minimal CTA -->
    <section class="max-w-article mx-auto text-center py-16">
      <p class="font-serif text-headline text-ink-secondary mb-6">
        Want personalized recommendations?
      </p>
      <p class="text-body text-ink-tertiary mb-8">
        Text us at <strong class="text-ink">(323) 922-4067</strong> and tell us where you want to go.
      </p>
      <a
        href="sms:+13239224067"
        class="inline-block text-small uppercase tracking-wider border border-ink px-8 py-3 hover:bg-ink hover:text-white transition-all"
      >
        Start a conversation
      </a>
    </section>

  </div>
</BaseLayout>
