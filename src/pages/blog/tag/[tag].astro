---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import BlogArticleCard from '../../../components/BlogArticleCard.astro';
import CategoryPill from '../../../components/CategoryPill.astro';
import { getAllTags, getPostsByTag, getCurrentYear } from '../../../utils/content';

export async function getStaticPaths() {
  const tags = getAllTags();
  return tags.map(tag => ({
    params: { tag: tag.toLowerCase().replace(/\s+/g, '-') },
    props: { originalTag: tag }
  }));
}

const { tag } = Astro.params;
const { originalTag } = Astro.props;
const posts = getPostsByTag(originalTag);
const currentYear = getCurrentYear();

// Format tag for display
const tagDisplay = originalTag.replace(/-/g, ' ').replace(/\b\w/g, (c: string) => c.toUpperCase());

const schemas = [
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": `${tagDisplay} Travel Articles | Otherwhere Blog`,
    "description": `Articles about ${tagDisplay.toLowerCase()}. Travel tips, guides, and insights.`
  }
];
---

<BaseLayout
  title={`${tagDisplay} Travel Articles (${currentYear}) | Otherwhere Blog`}
  description={`Articles about ${tagDisplay.toLowerCase()}. Travel tips, guides, and insights from Otherwhere.`}
  schema={schemas}
>
  <!-- Hero Section (Cream) -->
  <section class="bg-paper py-12 md:py-16">
    <div class="max-w-wide mx-auto px-6">
      <a href="/blog" class="text-xs uppercase tracking-widest text-ink-tertiary hover:text-ink transition-colors mb-6 inline-block">
        ‚Üê ALL ARTICLES
      </a>
      <header class="mb-10">
        <CategoryPill category={tagDisplay} variant="dark" class="mb-4" />
        <h1 class="font-display text-4xl md:text-5xl lg:text-6xl tracking-wide">
          {tagDisplay.toUpperCase()}
        </h1>
        <p class="text-ink-secondary mt-4 text-lg">
          {posts.length} article{posts.length !== 1 ? 's' : ''} tagged with "{tagDisplay.toLowerCase()}"
        </p>
      </header>
    </div>
  </section>

  <!-- Articles Grid (Dark) -->
  <section class="section-dark py-16 md:py-20">
    <div class="max-w-wide mx-auto px-6">
      {posts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
          {posts.map((post, index) => (
            <BlogArticleCard post={post} variant="dark" index={index} />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-paper/70 text-lg mb-4">No articles with this tag yet.</p>
          <a href="/blog" class="btn-pill btn-pill-light inline-block">
            Browse all articles
          </a>
        </div>
      )}
    </div>
  </section>

  <!-- CTA (Cream) -->
  <section class="bg-paper py-20 md:py-24">
    <div class="max-w-wide mx-auto px-6 text-center">
      <p class="text-xs uppercase tracking-widest text-ink-tertiary mb-4" style="letter-spacing: 0.15em;">
        QUESTIONS?
      </p>
      <h2 class="font-display text-3xl md:text-4xl lg:text-5xl mb-6">
        HAVE A QUESTION ABOUT {tagDisplay.toUpperCase()}?
      </h2>
      <p class="text-ink-secondary text-lg mb-10 max-w-md mx-auto">
        Text us your travel question. We're happy to help, even if you're not ready to book.
      </p>
      <a href="sms:+13239224067" class="btn-pill btn-pill-primary inline-block">
        TEXT US A QUESTION
      </a>
    </div>
  </section>
</BaseLayout>
